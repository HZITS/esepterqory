<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../editor/editor-module.html">

<dom-module id="dashboard-add-problem-module">
    <template>
        <style include="shared-styles">    
        
            editor-module {
                --editor-height: 150px;
                margin-top: 32px;
            }

            .head{
                border-bottom: 2px solid var(--paper-grey-300);
                height: 40px;
                line-height: 40px;
                background-color: var(--paper-grey-200);
                padding-left: 16px;
                padding-right: 16px
            }

            .body{
                overflow: auto;
                 padding: 16px;
                 padding-bottom: 0;
            }
            .title{
                color:var(--paper-grey-600);
                font-weight: 300;
                padding-top: 16px
            }
            .wrapper{
                width: 700px;
                background-color: white
            }
        </style>
        <div class="wrapper">
            <div class="head layout horizontal justified">
                <div title>Новая задача</div>
            </div>
            <div class="body">
                <paper-input no-label-float label="Номер задачи" value="{{number}}"></paper-input>
                <editor-module placeholder="Описание проблемы" id="problem"></editor-module>
                <!--<div class="title">Описание решения</div>-->
                <editor-module placeholder="Описание решения" id="solution"></editor-module> 
                <template is="dom-if" if="[[!edit]]"> 
                     <div class="mainButton" on-click="add">Добавить</div>
                </template>
                <template is="dom-if" if="[[edit]]"> 
                    <div class="mainButton" on-click="save">Сохранить</div>
                </template>
            </div>
        </div>
    </template>
    <script>
        class DashboardEditorModule extends Polymer.Element {

            static get is() { return 'dashboard-add-problem-module' }

            static get properties() {
                return {
                    topic: Object,
                    edit: {
                        type: Boolean,
                        value: false
                    },
                    problem: {
                        type: Object,
                        observer: 'problemChanged'
                    }
                }
            }

            static get observers() {
                return [
                ]
            }

            connectedCallback(){
                super.connectedCallback()
            }

            problemChanged(problem){
                this.edit = true
                this.$.problem.setHTML(problem.problem)
                this.$.solution.setHTML(problem.solution)
                this.number = problem.number
            }

            save(){
                ajax().put("/api/problems/id/" + this.problem._id, {
                    number: this.number,
                    problem: this.$.problem.getHTML(),
                    solution: this.$.solution.getHTML()
                })
                .then( res => {
                    console.log(res)
                })

                this.dispatchEvent(new CustomEvent('reload-problems', {
                    bubbles: true, 
                    composed: true
                }))
            }

            add(){ 
                ajax().post("/api/problems", {
                    path: this.topic.path,
                    number: this.number,
                    problem: this.$.problem.getHTML(),
                    solution: this.$.solution.getHTML()
                })
                .then( res => {
                    console.log(res)
                })
            }

        }
        customElements.define(DashboardEditorModule.is, DashboardEditorModule);
    </script>
</dom-module>