<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link href="../modules/section-module.html">

<dom-module id="home-module">
    <template>
        <style include="shared-styles">
            :host{
                display: flex;
                flex-direction: row;
            }
            :host > section-module{
                flex: 1 ;
                height: calc(100vh - 122px);
                border-right: 1px solid var(--paper-grey-300)
            }
            .listItem{
                height: 32px;
                line-height: 32px;
                color: var(--paper-grey-700);
                padding-left: 16px; 
            }
            .listItem:hover{
                color: black;
                background-color: var(--paper-grey-300);
                cursor: pointer
            }
        </style>
        <section-module
            title-link="Теория"
            link="/articles/topics"
        >
            <div class="list" slot="list">
                <iron-list items="[[topic.subtopics]]" selection-enabled selected-item="{{selectedItem}}">
                    <template>
                        <a class="listItem" href$="articles/[[item._id]]">
                            [[item.title]]([[item.articlesCount]])
                        </a>
                    </template>
                </iron-list>
            </div>
        </section-module>
        <section-module
            title-link="Каталог по темам"
            link="/topics/topics"
        >
            <div class="list" slot="list">
                <iron-list items="[[topic.subtopics]]" selection-enabled selected-item="{{selectedItem}}">
                    <template>
                        <a class="listItem" href$="topics/[[item._id]]">
                            [[item.title]]([[item.problemsCount]])
                        </a>
                    </template>
                </iron-list>
            </div>
        </section-module>
        <section-module
            title-link="Каталог по источникам"
            link="/sources/sources"
        >
            <div class="list" slot="list">
                <iron-list items="[[sources.subtopics]]" selection-enabled selected-item="{{selectedItem}}">
                    <template>
                        <a class="listItem" href$="sources/[[item._id]]">
                            [[item.title]]([[item.problemsCount]])
                        </a>
                    </template>
                </iron-list>
            </div>
        </section-module>
    </template>
    <script>
        class HomeModule extends Polymer.Element {

            static get is() { return 'home-module' }

            connectedCallback(){
                super.connectedCallback()

                ajax().get("/api/topics/topics", { populate: true})
                .then( res => {
                    if(res == "doesn't exist") {
                        return
                    }

                    var topic = res
                    if (!(topic.subtopics instanceof Array)){
                        topic.subtopics = [topic.subtopics]
                    }
                    this.topic = topic

                })

                ajax().get("/api/topics/sources", { populate: true})
                .then( res => {
                    if(res == "doesn't exist") {
                        return
                    }

                    var topic = res
                    if (!(topic.subtopics instanceof Array)){
                        topic.subtopics = [topic.subtopics]
                    }
                    this.sources = topic

                })

            }

        }
        customElements.define(HomeModule.is, HomeModule);
    </script>
</dom-module>